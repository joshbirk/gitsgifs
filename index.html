<HTML>
<HEAD>
    
</HEAD>

<BODY>
    <div id="status" style="display:none">Hello world.</div>
    <div id="container"></div>
    <canvas id="canvas">
        Canvas not supported
    </canvas>
    <script src="https://unpkg.com/gifler@0.1.0/gifler.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        document.getElementById('status').innerHTML = 'Connected';
  
        // use external library to parse and draw gif animation
        function onDrawFrame(ctx, frame) {
            // update canvas size
            canvas.width = frame.width;
            canvas.height = frame.height;
            // update canvas that we are using for Konva.Image
            ctx.drawImage(frame.buffer, 0, 0);
            // redraw the layer
            layer.draw();
        }

        socket.on("image", function(info) {
            if (info.image) {
                console.log(info.src);
        
                var element = document.getElementById("canvas");
	            element.parentNode.removeChild(element);
                const new_canvas = document.createElement("canvas");
                new_canvas.id = "canvas";
                document.body.appendChild(new_canvas);

                var canvas = document.getElementById('canvas')
                var context = canvas.getContext('2d');
                context.clearRect(0, 0, canvas.width, canvas.height);

                gifler(info.src).animate('canvas');

                document.getElementById('status').innerHTML = 'Image Drawn';
                setTimeout(function() {
                    var element = document.getElementById("canvas");
	                element.parentNode.removeChild(element);
                    const new_canvas = document.createElement("canvas");
                    new_canvas.id = "canvas";
                    document.body.appendChild(new_canvas);

                    },3000);
                }
            });
    </SCRIPT>
</BODY>
</HTML>